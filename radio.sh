#!/bin/bash

##############################################################################
# CONFIGURACIÓN INICIAL DEL TERMINAL
##############################################################################

tput civis
trap 'tput cnorm; exit' INT TERM EXIT

##############################################################################
# RUTAS BASE
##############################################################################

BASE_DIR="$(cd "$(dirname "$0")" && pwd)"
LIB="$BASE_DIR/lib"

##############################################################################
# CARGA DE LIBRERÍAS
##############################################################################

source "$LIB/config.sh"
source "$LIB/state.sh"
source "$LIB/deps.sh"
source "$LIB/ui.sh"
source "$LIB/player.sh"
source "$LIB/search.sh"
source "$LIB/input.sh"

##############################################################################
# COMPROBACIÓN DE DEPENDENCIAS
##############################################################################

comprobar_dependencias

##############################################################################
# INICIALIZACIÓN
##############################################################################

init_state
init_player

load_state
load_favorites

##############################################################################
# REANUDAR ÚLTIMA EMISORA (SI EXISTE)
##############################################################################

if [ -n "$LAST_URL" ]; then
    reproducir "$LAST_NAME" "$LAST_URL"
fi

##############################################################################
# BUCLE PRINCIPAL
##############################################################################

main_loop
